{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://lzfof.dev/schemas/test-case.json",
    "title": "LZFOF Test Case Schema",
    "description": "Unified schema for all LZFOF test case types",
    "definitions": {
        "baseCase": {
            "type": "object",
            "required": [
                "id"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the test case"
                },
                "description": {
                    "type": "string",
                    "description": "Human-readable description"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Tags for filtering (e.g., edge-case, mutation, critical)"
                }
            }
        },
        "functionCase": {
            "allOf": [
                {
                    "$ref": "#/definitions/baseCase"
                },
                {
                    "type": "object",
                    "required": [
                        "input",
                        "expected"
                    ],
                    "properties": {
                        "input": {
                            "description": "Arguments to pass to the function (array or single value)"
                        },
                        "expected": {
                            "description": "Expected return value"
                        },
                        "timeout": {
                            "type": "number",
                            "description": "Max execution time in ms"
                        }
                    }
                }
            ]
        },
        "regexCase": {
            "allOf": [
                {
                    "$ref": "#/definitions/baseCase"
                },
                {
                    "type": "object",
                    "required": [
                        "input",
                        "expected"
                    ],
                    "properties": {
                        "input": {
                            "type": "string",
                            "description": "String to test against the regex"
                        },
                        "expected": {
                            "type": "boolean",
                            "description": "Whether the regex should match"
                        },
                        "captureGroups": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "description": "Expected capture groups if matching"
                        }
                    }
                }
            ]
        },
        "promptCase": {
            "allOf": [
                {
                    "$ref": "#/definitions/baseCase"
                },
                {
                    "type": "object",
                    "required": [
                        "input"
                    ],
                    "properties": {
                        "input": {
                            "type": "string",
                            "description": "Content to process with the prompt"
                        },
                        "expectedKeys": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "description": "Keys expected in structured output"
                        },
                        "minScore": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Minimum quality score threshold"
                        },
                        "maxTokens": {
                            "type": "number",
                            "description": "Maximum acceptable token count"
                        }
                    }
                }
            ]
        },
        "configCase": {
            "allOf": [
                {
                    "$ref": "#/definitions/baseCase"
                },
                {
                    "type": "object",
                    "required": [
                        "scenario"
                    ],
                    "properties": {
                        "scenario": {
                            "type": "object",
                            "description": "Input scenario parameters"
                        },
                        "expectSuccess": {
                            "type": "boolean",
                            "description": "Whether the config should pass this scenario"
                        }
                    }
                }
            ]
        },
        "queryCase": {
            "allOf": [
                {
                    "$ref": "#/definitions/baseCase"
                },
                {
                    "type": "object",
                    "required": [
                        "variables"
                    ],
                    "properties": {
                        "variables": {
                            "type": "object",
                            "description": "Template variables to fill in query"
                        },
                        "minResults": {
                            "type": "number",
                            "description": "Minimum expected results"
                        },
                        "requiredTerms": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "description": "Terms that must appear in results"
                        }
                    }
                }
            ]
        }
    },
    "type": "object",
    "required": [
        "cases"
    ],
    "properties": {
        "$schema": {
            "type": "string"
        },
        "targetType": {
            "type": "string",
            "enum": [
                "function",
                "regex",
                "prompt",
                "config",
                "query",
                "struct"
            ],
            "description": "Type of target being tested"
        },
        "cases": {
            "type": "array",
            "items": {
                "oneOf": [
                    {
                        "$ref": "#/definitions/functionCase"
                    },
                    {
                        "$ref": "#/definitions/regexCase"
                    },
                    {
                        "$ref": "#/definitions/promptCase"
                    },
                    {
                        "$ref": "#/definitions/configCase"
                    },
                    {
                        "$ref": "#/definitions/queryCase"
                    }
                ]
            }
        },
        "corpus": {
            "type": "array",
            "description": "Alternative name for cases (regex compatibility)",
            "items": {
                "$ref": "#/definitions/regexCase"
            }
        },
        "metadata": {
            "type": "object",
            "properties": {
                "createdAt": {
                    "type": "string",
                    "format": "date-time"
                },
                "lastRun": {
                    "type": "string",
                    "format": "date-time"
                },
                "version": {
                    "type": "string"
                }
            }
        }
    }
}